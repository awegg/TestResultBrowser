@using TestResultBrowser.Web.Models

@if (Matrix == null)
{
    <MudAlert Severity="Severity.Info">No matrix data.</MudAlert>
}
else
{
    <table class="mud-table" style="width:100%;">
        <thead>
            <tr>
                <th>Version \ Config</th>
                @foreach (var nc in Matrix.NamedConfigs)
                {
                    <th>@nc</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var version in Matrix.Versions)
            {
                <tr>
                    <td style="font-weight:600;">@version</td>
                    @foreach (var nc in Matrix.NamedConfigs)
                    {
                        <td>
                            @{ var cell = Matrix.Cells.TryGetValue(version, out var map) && map.TryGetValue(nc, out var c) ? c : null; }
                            @if (cell == null)
                            {
                                <span>N/A</span>
                            }
                            else
                            {
                                var isFail = cell.FailedTests > 0;
                                var cellClass = isFail ? "config-cell config-cell--fail" : "config-cell config-cell--pass";
                                var statusLabel = isFail ? "FAIL" : "PASS";
                                <button class="@cellClass" @onclick="(() => OnCellClick.InvokeAsync(cell.ConfigurationId))" aria-label="@($"{statusLabel} {cell.PassRate:F1}%")">
                                    <span class="config-cell-label">@statusLabel</span>
                                    <span class="config-cell-rate">@cell.PassRate.ToString("F1")%</span>
                                </button>
                            }
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
}

@code {
    [Parameter] public ConfigurationMatrix? Matrix { get; set; }
    [Parameter] public EventCallback<string> OnCellClick { get; set; }
}

<style>
    .config-cell {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-width: 72px;
        padding: 6px 8px;
        border-radius: 6px;
        border: 2px solid #111;
        font-weight: 700;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 0.4px;
    }

    .config-cell--pass {
        background-color: #0b6e1c;
        color: #fff;
    }

    .config-cell--fail {
        background-color: #8b1a1a;
        color: #fff;
    }

    .config-cell-label {
        font-size: 0.7rem;
        line-height: 1;
    }

    .config-cell-rate {
        font-size: 0.85rem;
        line-height: 1.1;
    }
</style>
